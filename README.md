# chat_room
关于聊天室的跨网段问题，本代码采用云服务器中转消息方法实现跨网段交流

# 核心思想

## 中转
客户端发消息给云服务器,云服务器将消息发送给连接上服务器的所有客户。当用户进入聊天室时，服务器会要求客户输入昵称,当昵称输入完毕后会向所有用户发送XXX进入聊天室。退出聊天室同样。

# 为什么写聊天室？
这并不是想写一个聊天软件。这是为了解决单片机跨网段通讯的问题。如果手机上运行一个客户端代码，在远端树莓派也运行一个客户端，手机端就可以给树莓派发送消息以便控制树莓派。

# 关于zongfuwu.py
这是整个项目的基础，无条件转发消息

# 关于shumeipai.py
这是基于聊天室代码。当树莓派接受到paizhao的消息时。树莓派打开摄像头使用opencv拍照得到一张照片

# 关于shumeipai2.py
新增加了远程控制树莓派小车移动的代码

# 关于duoji.py
此代码是基于聊天室的基础上发展而来，客户端B发送舵机角度。树莓派连接的舵机就会转动对应的角度。实际上也就是增加了舵机的转动函数以及初始化函数。
在服务端，我们取消了昵称的要求，这是为了方便将文字转化为数字。在客户端B代码没变。

# 关于Flask_duoji文件夹
此代码是基于控制舵机的代码发展而来。这里我们创建了一个Flask项目，当运行app.py时，app.py既是一个Flask服务器也是duoji.py聊天室的一个客户，当用户访问Flask客户端时，app.py会向用户返回一个html页面。
当用户输入数据后，数据会传递给app.py，此时由于app.py是聊天室的客户端，数据会发送给聊天室duoji.py的服务器，这样数据会成功的发送给舵机的客户端，舵机就会转动。
![image](https://github.com/nuaajc-lab107/chat_room/blob/main/%E6%97%A0%E6%A0%87%E9%A2%98.png)

# 关于ESP8266_chat.ino
此代码是使用ESP8266制作的客户端，此时ESP8266就像服务器的另一个客户，当我在电脑上启动客户端端时，向服务器发送“b”，ESP8266 D2连接的LED将会闪烁

# 关于wifi_xiaoche.ino
此代码是ESP8266控制小车代码，在另一个xiaoche_to_ESP8266.py上可以使用wsad控制小车前进、后退、左转、右转

# 关于xiaoche_to_ESP8266.py
这是客户端代码，它会检测用户键盘输入，当用户一直按着某个键时（例如：w）它将会一直向服务器发送w

# 关于paizhao文件夹
paizhao.py是运行在树莓派上的文件，它本质上还是聊天室服务器的一个客户端。当收到“paizhao”消息后，使用opencv拍摄一张照片，然后这张照片会发送到Flask服务器。app.py是Flask服务器，当用户访问Flask时。app.py会向用户返回index.html，这个页面有一个拍照按钮，当用户按下按钮时，Flask会向服务器发送一个“paizhao”消息。此时树莓派上的paizhao.py将执行拍照函数。然后树莓派将会发送图片到Flask服务器。

![image](https://github.com/nuaajc-lab107/chat_room/blob/main/paizhao.png)

# 关于yaokong文件夹
这里使用了另一个ESP8266连接服务器，当按钮按下时引脚将会读取信息。四个按钮控制前进、后退、左转、右转
